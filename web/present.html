<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Exhibit v0.2.4</title>
  <script src="/static/present.js"></script>
  <link rel="stylesheet" href="/static/present.css">
</head>

<body>
  <div id="app"></div>
  <script>
  var app = Elm.Present.init({
    node: document.getElementById('app')
  });

    var socket = null;

	app.ports.socketConnect.subscribe(function(message) {
		let location = ((window.location.protocol === "https:") ? "wss://" : "ws://") + window.location.host + message;
		console.log("Opening socket to " + location)
		socket = new WebSocket(location);

		// When a command goes to the `sendMessage` port, we pass the message
		// along to the WebSocket.
		app.ports.sendMessage.subscribe(function(message) {
			console.log("Sending message: " + message);
			socket.send(message);
		});

		// When a message comes into our WebSocket, we pass the message along
		// to the `messageReceiver` port.
		socket.addEventListener("message", function(event) {
			console.log("Message received: " + event.data);
			app.ports.messageReceived.send(event.data);
		});

		socket.addEventListener("close", (event) => {
			console.log("Socket closed");
			app.ports.socketDisconnected.send("");
		});
	});

  </script>
</body>
</html>